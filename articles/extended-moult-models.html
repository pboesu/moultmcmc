<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extended moult models • moultmcmc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extended moult models">
<meta property="og:description" content="moultmcmc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">moultmcmc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9030</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extended-moult-models.html">Extended moult models</a>
    </li>
    <li>
      <a href="../articles/getting-started.html">Getting started with moultmcmc</a>
    </li>
    <li>
      <a href="../articles/moult-likelihoods.html">Moult data likelihoods and model priors</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extended-moult-models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extended moult models</h1>
            
      
      
      <div class="hidden name"><code>extended-moult-models.Rmd</code></div>

    </div>

    
    
<p>To install <code>moultmcmc</code> please follow the instructions in the <a href="https://github.com/pboesu/moultmcmc#installation" class="external-link">README file</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">moult</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">moultmcmc</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="lumped-models">Lumped models<a class="anchor" aria-label="anchor" href="#lumped-models"></a>
</h2>
<p>The gradual transition from new to old plumage between successive moults can make the assignment of non-moulting birds to pre-moult and post-moult categories ambiguous. This classification problem can be sidestepped by distinguishing only two categories of birds: moulting and non-moulting birds, which is implemented in the so called “lumped” moult models in <code>moultmcmc</code>.</p>
<p>The following example demonstrates the use of the lumped type 2 moult model. It is based on a dataset originally supplied with the <code>moult</code> package <span class="citation">(Erni et al. 2013)</span> on Southern Masked Weavers (<em>Ploceus velatus</em>), all caught in the Western Cape province of South Africa <span class="citation">(Oschadleus 2005)</span>. For convenience the data set is provided with processed moult scores in <code>moultmcmc</code> as <code>weavers_processed</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">weavers_processed</span><span class="op">)</span></span>
<span><span class="va">weavers_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weavers_processed</span>, <span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1993</span><span class="op">:</span><span class="fl">2003</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">weavers_processed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">day</span>, y <span class="op">=</span><span class="va">pfmg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'PFMG'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Days since 01 August'</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/lumped-demo-1.png" width="672"></p>
<p>We then fit both standard and lumped type 2 moult models to this dataset. The lumped model can be activated by setting the option <code>lump_non_moult = TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span><span class="st">'pfmg'</span>,</span>
<span>                 <span class="st">'day'</span>,</span>
<span>                 data<span class="op">=</span><span class="va">weavers_processed</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mc2l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span><span class="st">'pfmg'</span>,</span>
<span>                  <span class="st">'day'</span>,</span>
<span>                  data<span class="op">=</span><span class="va">weavers_processed</span>,</span>
<span>                  lump_non_moult <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  chains <span class="op">=</span> <span class="fl">2</span>, cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We also fit a type 3 model to these data, following the recommendation in <span class="citation">Erni et al. (2013)</span>. This model type only uses active moult records, and therefore is unaffected by misclassification in the non-moulting birds.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span><span class="st">'pfmg'</span>,</span>
<span>                 <span class="st">'day'</span>,</span>
<span>                 data<span class="op">=</span><span class="va">weavers_processed</span>,</span>
<span>                 type <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">2</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>   <span class="fu"><a href="../reference/moult_plot.html">moult_plot</a></span><span class="op">(</span><span class="va">mc2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>,<span class="fl">575</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Type 2 model'</span><span class="op">)</span>,</span>
<span>   <span class="fu"><a href="../reference/moult_plot.html">moult_plot</a></span><span class="op">(</span><span class="va">mc2l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>,<span class="fl">575</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Lumped type 2 model (T2L)'</span><span class="op">)</span>,</span>
<span>   <span class="fu"><a href="../reference/moult_plot.html">moult_plot</a></span><span class="op">(</span><span class="va">mc3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>,<span class="fl">575</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Type 3 model'</span><span class="op">)</span>,</span>
<span>   nrow<span class="op">=</span><span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/lumped-model-plots-1.png" width="672"></p>
<p>The moult plots make it clear that the standard type 2 model estimates an unrealistically large standard deviation of the start date, implying that the moult period for the population exceeds a calendar year. In contrast both the lumped type 2 model and the type 3 model give plausible estimates, in that both sets of estimates are consistent with published moult parameters for this species <span class="citation">(Oschadleus 2005)</span>. However, the lumped type 2 model offers much higher nominal precision, as apparent from the model comparison plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_plot.html">compare_plot</a></span><span class="op">(</span><span class="va">mc3</span>,<span class="va">mc2</span>,<span class="va">mc2l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/lumped-model-compare-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="repeated-measures-moult-models">Repeated measures moult models<a class="anchor" aria-label="anchor" href="#repeated-measures-moult-models"></a>
</h2>
<p>When the assumption of even sampling among and within moult categories is violated, the standard moult model can converge at biologically non-sensible results.</p>
<p>This problem can be greatly reduced when information about the pace of moult from within-season recaptures of individuals is explicitly incorporated into to the parameter estimation using the model.</p>
<p>The repeated measures model is currently implemented for data types 2, 3 and 5 in the <code>moultmcmc</code> function. The repeated measures model is selected by supplying the optional argument <code>id_column</code> which designates <em>within season</em> recaptures, typically formed of a combination of ring number and season.</p>
<p>We demonstrate this here using simulated data which is biased towards records of birds in the early stages of moult, based on a citizen science dataset of moult scores from Eurasian Siskins (<em>Spinus spinus</em>) (<span class="citation">Insley, Beck, and Boersch-Supan (n.d.)</span>).</p>
<div class="figure">
<img src="extended-moult-models_files/figure-html/siskin-hist-1.png" alt="Frequency distribution of moult records with respect to moult progress for actively moulting Eurasian Siskins [@insley2022moult] sampled in a sub-urban garden in Scotland (left) and seasonal progression of observed moult scores from the same dataset (right). Lines connect repeated observations of the same individuals." width="672"><p class="caption">
Frequency distribution of moult records with respect to moult progress for actively moulting Eurasian Siskins <span class="citation">(Insley, Beck, and Boersch-Supan, n.d.)</span> sampled in a sub-urban garden in Scotland (left) and seasonal progression of observed moult scores from the same dataset (right). Lines connect repeated observations of the same individuals.
</p>
</div>
<p>The standard models are fitted by not specifying the <code>id_column</code> input argument (which implies <code>id_column = NULL</code>):</p>
<p>and the repeated measures models by passing the information about bird identities to the <code><a href="../reference/moultmcmc.html">moultmcmc()</a></code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fit the equivalent recapture models</span></span>
<span><span class="va">uz3_recap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span>moult_column <span class="op">=</span> <span class="st">'pfmg'</span>,</span>
<span>                       date_column <span class="op">=</span> <span class="st">'yday'</span>,</span>
<span>                       id_column <span class="op">=</span> <span class="st">'hexid'</span>,</span>
<span>                       start_formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>                       duration_formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>                       type <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                       log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       data<span class="op">=</span><span class="va">siskins</span>,</span>
<span>                       iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       chain <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">uz3_recap</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 102.864</span></span>
<span><span class="co">#</span></span>
<span><span class="va">uz5_recap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span><span class="st">'pfmg'</span>,</span>
<span>                       <span class="st">'yday'</span>,</span>
<span>                       <span class="st">'hexid'</span>,</span>
<span>                       start_formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>                       duration_formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>                       type <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                       log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       data<span class="op">=</span><span class="va">siskins</span>,</span>
<span>                       iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       chain <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">uz5_recap</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.807</span></span></code></pre></div>
<p>When comparing the results visually it is apparent that the moult period for the population predicted by the standard Type 3 models fails to encapsulate a substantial proportion of the observed data, whereas this is not the case for the repeated measures model. The bias in Type 5 model estimates is less severe.</p>
<pre><code><span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; Warning: Removed 1 rows containing missing values (`geom_point()`).</span></span>
<span><span class="co">#&gt; Removed 1 rows containing missing values (`geom_point()`).</span></span></code></pre>
<div class="figure">
<img src="extended-moult-models_files/figure-html/siskin-model-plots-1.png" alt="Standard type 3 and 5 moult models fitted to the Siskin dataset without considering within-season recaptures converge at biased parameter estimates (red lines and polygons). When recapture information is included in the model, the resulting fits (green lines and polygons) better encapsulate the observed data." width="672"><p class="caption">
Standard type 3 and 5 moult models fitted to the Siskin dataset without considering within-season recaptures converge at biased parameter estimates (red lines and polygons). When recapture information is included in the model, the resulting fits (green lines and polygons) better encapsulate the observed data.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_plot.html">compare_plot</a></span><span class="op">(</span><span class="va">uz3</span>,<span class="va">uz3_recap</span>,<span class="va">uz5</span>,<span class="va">uz5_recap</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>As these are simulated data we can also assess how well the recapture model estimates individual start dates, by extracting the random intercept estimates with the <code><a href="../reference/ranef.moultmcmc.html">ranef()</a></code> method and comparing them to the simulated data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ranef.moultmcmc.html">ranef</a></span><span class="op">(</span><span class="va">uz3_recap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">'hexid'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">siskins</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>est_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>,</span>
<span>            lci_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">`2.5%`</span><span class="op">)</span>,</span>
<span>            uci_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">`97.5%`</span><span class="op">)</span>,</span>
<span>            true_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>,</span>
<span>            true_dur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span>,</span>
<span>            n_total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            n_active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pfmg</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = "hexid"</span></span>
<span></span>
<span><span class="va">t3r_intercepts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ints</span>,</span>
<span>                         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">true_start</span> <span class="op">-</span> <span class="fl">196.83</span>,</span>
<span>                             y <span class="op">=</span> <span class="va">est_start</span>,</span>
<span>                             ymin <span class="op">=</span> <span class="va">lci_start</span>,</span>
<span>                             ymax <span class="op">=</span> <span class="va">uci_start</span>,</span>
<span>                             fill <span class="op">=</span> <span class="va">true_dur</span> <span class="op">-</span> <span class="fl">77.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'T3R'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'estimated start date'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'true start date'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">est_start</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">true_start</span> <span class="op">-</span> <span class="fl">196.83</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ints</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             2.5 %   97.5 %</span></span>
<span><span class="co">#&gt; (Intercept)            -3.6512665 1.228751</span></span>
<span><span class="co">#&gt; I(true_start - 196.83)  0.7615629 1.700839</span></span>
<span></span>
<span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ranef.moultmcmc.html">ranef</a></span><span class="op">(</span><span class="va">uz5_recap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">'hexid'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">siskins</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>est_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>,</span>
<span>            lci_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">`2.5%`</span><span class="op">)</span>,</span>
<span>            uci_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">`97.5%`</span><span class="op">)</span>,</span>
<span>            true_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>,</span>
<span>            true_dur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span>,</span>
<span>            n_total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            n_active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pfmg</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = "hexid"</span></span>
<span></span>
<span><span class="va">t5r_intercepts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ints</span>,</span>
<span>                         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">true_start</span> <span class="op">-</span> <span class="fl">196.83</span>,</span>
<span>                             y <span class="op">=</span> <span class="va">est_start</span>,</span>
<span>                             ymin <span class="op">=</span> <span class="va">lci_start</span>,</span>
<span>                             ymax <span class="op">=</span> <span class="va">uci_start</span>,</span>
<span>                             fill <span class="op">=</span> <span class="va">true_dur</span> <span class="op">-</span> <span class="fl">77.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'T5R'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'estimated start date'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'true start date'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">est_start</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">true_start</span> <span class="op">-</span> <span class="fl">196.83</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ints</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             2.5 %    97.5 %</span></span>
<span><span class="co">#&gt; (Intercept)            -0.3362297 0.9051314</span></span>
<span><span class="co">#&gt; I(true_start - 196.83)  0.8724174 1.0485303</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">t3r_intercepts</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span>,</span>
<span>                   <span class="va">t5r_intercepts</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span>
<span><span class="co">#&gt; Warning: The following aesthetics were dropped during statistical transformation: <span style="color: #00BB00;">fill</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> This can happen when ggplot fails to infer the correct grouping structure in</span></span>
<span><span class="co">#&gt;   the data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Did you forget to specify a `group` aesthetic or to convert a numerical</span></span>
<span><span class="co">#&gt;   variable into a factor?</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span>
<span><span class="co">#&gt; Warning: The following aesthetics were dropped during statistical transformation: <span style="color: #00BB00;">fill</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> This can happen when ggplot fails to infer the correct grouping structure in</span></span>
<span><span class="co">#&gt;   the data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Did you forget to specify a `group` aesthetic or to convert a numerical</span></span>
<span><span class="co">#&gt;   variable into a factor?</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/ind-intercepts-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#TODO: I think the function now returns the internal index of the random effects vector but matches that to the global index of individuals?!</span></span></code></pre></div>
<p>We find that agreement between simulations and estimates is good, even though the model does not explicitly account for heterogeneity in individual moult durations. For both models a regression of estimated versus true start dates has an intercept indistinguishable form 0 and a slope indistinguishable from 1.</p>
</div>
<div class="section level2">
<h2 id="mixed-moult-records">Mixed moult records<a class="anchor" aria-label="anchor" href="#mixed-moult-records"></a>
</h2>
<p><code>moultmcmc</code> also allows to fit a mixture of categorical and continuous moult records, by combining the relevant likelihoods from the type 1 and type 2 models, as originally suggested in <span class="citation">Underhill and Zucchini (1988)</span>. This, so-called <strong>Type 12</strong> model can be employed to boost sample sizes and/or allow better balancing of moult and non-moult records <span class="citation">(Bonnevie 2010)</span> when multiple types of records are available.</p>
<p>We can simulate such a dataset by splitting the <code>sanderlings</code> dataset into two, and degrading the moult scores in one subsample to moult categories</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sanderlings</span> <span class="op">&lt;-</span> <span class="fu">moult</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/moult/man/sanderlings.html" class="external-link">sanderlings</a></span></span>
<span></span>
<span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sanderlings</span><span class="op">$</span><span class="va">MCat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="co">#introduce a couple of NAs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">sanderlings</span><span class="op">$</span><span class="va">keep_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sanderlings</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sanderlings_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sanderlings</span>, <span class="va">keep_score</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sanderlings_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sanderlings</span>, <span class="va">keep_score</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MCat</span><span class="op">[</span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sanderlings_cat</span><span class="op">$</span><span class="va">MIndex</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sanderlings_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">MIndex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sanderlings_cat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">MCat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/mixed-data-1.png" width="672"></p>
<p>The two datasets can then be pieced together again, and the function <code>consolidate_moult_records</code> is used to consolidate and recode moult score and moult category data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sanderlings_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">sanderlings_scores</span>, <span class="va">sanderlings_cat</span><span class="op">)</span></span>
<span><span class="va">sanderlings_combined</span><span class="op">$</span><span class="va">MIndexCat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate_moult_records.html">consolidate_moult_records</a></span><span class="op">(</span><span class="va">sanderlings_combined</span><span class="op">$</span><span class="va">MIndex</span>, <span class="va">sanderlings_combined</span><span class="op">$</span><span class="va">MCat</span><span class="op">)</span></span></code></pre></div>
<p>We can then fit Type 1 and Type 2 models to each of the split datasets, as well as the Type 12 model for the recombined dataset, and for reference a Type 2 model to the original data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span>moult_column <span class="op">=</span> <span class="st">"MIndex"</span>,</span>
<span>                 date_column <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">sanderlings_scores</span>,</span>
<span>                 type <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span>moult_column <span class="op">=</span> <span class="st">"MCat"</span>,</span>
<span>                 date_column <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">sanderlings_cat</span>,</span>
<span>                 type <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_combined</span> <span class="op">=</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span>moult_column <span class="op">=</span> <span class="st">"MIndexCat"</span>,</span>
<span>                 date_column <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">sanderlings_combined</span>,</span>
<span>                 type <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                 log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_original</span> <span class="op">=</span> <span class="fu"><a href="../reference/moultmcmc.html">moultmcmc</a></span><span class="op">(</span>moult_column <span class="op">=</span> <span class="st">"MIndex"</span>,</span>
<span>                 date_column <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">sanderlings</span>,</span>
<span>                 type <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_plot.html">compare_plot</a></span><span class="op">(</span><span class="va">fit_scores</span>, <span class="va">fit_cat</span>, <span class="va">fit_combined</span>, <span class="va">fit_original</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended-moult-models_files/figure-html/mixed-data-model-comparison-1.png" width="672"> The estimates from the combined model (T12) are closer to the estimates from the original dataset, than estimates from either partial dataset.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-bonnevie2010balancing">
<p>Bonnevie, Bo T. 2010. “Balancing Moult Data by Subsampling Non-Moulting Birds Prior to Regression Analysis.” <em>Ostrich</em> 81 (3): 265–68.</p>
</div>
<div id="ref-erni2013moult">
<p>Erni, Birgit, Bo T. Bonnevie, Hans-Dieter Oschadleus, Res Altwegg, and Les G. Underhill. 2013. “Moult: An R Package to Analyze Moult in Birds.” <em>Journal of Statistical Software</em> 52. <a href="https://doi.org/10.18637/jss.v052.i08" class="external-link">https://doi.org/10.18637/jss.v052.i08</a>.</p>
</div>
<div id="ref-insley2022moult">
<p>Insley, Hugh, Samantha Beck, and Philipp Boersch-Supan. n.d. “Breeding and moult phenology of siskins in the Scottish Highlands.”</p>
</div>
<div id="ref-oschadleus2005patterns">
<p>Oschadleus, Hans-Dieter. 2005. “Patterns of Primary Moult in the Weavers, Ploceidae.” PhD thesis, University of Cape Town.</p>
</div>
<div id="ref-underhill1988model">
<p>Underhill, Les G., and Walter Zucchini. 1988. “A Model for Avian Primary Moult.” <em>Ibis</em> 130: 358–72. <a href="https://doi.org/10.1111/j.1474-919x.1988.tb00993.x" class="external-link">https://doi.org/10.1111/j.1474-919x.1988.tb00993.x</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Philipp Boersch-Supan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
